---
title: "STAT 331 Final Project"
author: "Adam Manzke, Rianna Lei, Addie Lilley, Hannah Goudz" 
format:
  html:
    embed-resources: true
    code-tools: true
    code-fold: true
editor: source
execute: 
  error: true
  echo: true
  message: false
  warning: false
---

# Project Proposal + Data

## Introduction

The focus of our project is to research an association between inequality index and happiness score. We're interested in these variables because we were fascinated by the premise of quantifying happiness, and we'd like to find out if wealth inequality is related.

---

## Data and Variables

### Data Sources

- **Variable 1**: *Inequality Index* — downloaded from Gapminder ([https://data.worldbank.org/indicator/SI.POV.GINI])
- **Variable 2**: *Happiness Score* — downloaded from Gapminder ([http://gapm.io/dhapiscore_whr])

The Inequality Index is originally sourced from World Bank.


### Variables

- **Inequality Index**: Percent of inequality (percent deviation from the "ideal line", where every person in society has the same income). This is called the Gini Index. You can read more about this [here](https://en.wikipedia.org/wiki/Lorenz_curve).

- **Happiness Score**: Measurement from 0 to 100, where subjects were asked to rank their current life satisfaction, where 0 is the worst possible life for the subject and 100 is the best.

---

## Hypothesis

> We hypothesize that there is a strong negative relationship between happiness score and inequality index. [A study](https://www.forbes.com/sites/johnjennings/2024/02/12/money-buys-happiness-after-all/) showed that happiness increases with wealth (up to a point), so in countries with more wealth inequality, more people will rate their happiness lower.

---

## Data Cleaning Process

To prepare the data for analysis, we reshaped both datasets so that each row represents one country in a given year. We then combined the two sources by matching on country and year. Since happiness data only begins in 2005, we limited our analysis to the years 2005 through 2023. After merging the data, we excluded any rows where either the inequality index or the happiness score was missing.

The original source of the inequality data is the World Bank. The happiness scores come from a Gapminder dataset that compiles data from the World Happiness Report. The happiness score reflects the average self-reported life satisfaction for individuals in each country, measured on a scale from 0 to 100.

After removing missing values, the cleaned dataset included 134 countries with complete observations. We noted that most missing values occurred in earlier years and were more common among lower-income or smaller countries. This could introduce some bias if countries with less reliable reporting are systematically different.

```{r}
#| message: false
library(tidyverse)
library(knitr)
library(kableExtra)
library(broom)
# Read data
ineq <- read_csv("inequality_index_gini.csv")
happ <- read_csv("hapiscore_whr.csv")
```

```{r}
# Pivot longer
ineq_long <- ineq |> 
  pivot_longer(cols = -country,
               names_to = "year",
               values_to = "inequality_score") |> 
  mutate(year = as.integer(year))

happ_long <- happ |> 
  pivot_longer(cols = -country,
               names_to = "year",
               values_to = "happ_score") |> 
  mutate(year = as.integer(year))

# Join datasets - happiness starts at 2004 whereas ineq starts at 1963,
# so only keep observations from 2005 onward
gapminder_clean <- left_join(happ_long, ineq_long, by = c("country", "year"))

# Optional: drop rows with missing data
gapminder_clean <- gapminder_clean |> 
  drop_na()

```

---

## Summary

The cleaned dataset includes 134 countries and spans the years 2005 to 2023. Each row represents a country-year observation and includes values for both happpiness score and inequality index.

---

# Linear Regression

## Data Visualization

The scatterplot below shows the relationship between average inequality index and average happiness score for each country. The downward trend indicates a slight negative relationship between the two variables.
```{r}
gapminder_average <- gapminder_clean |> 
  group_by(country) |> 
  mutate(avg_happ = mean(happ_score),
         avg_ineq = mean(inequality_score))

gapminder_average |> 
  ggplot(aes(x = avg_ineq, y = avg_happ)) +
  geom_jitter() +
  geom_smooth(method = "lm") +
  labs(x = "Average Inequality Index",
       y = "Average Happiness Score",
       title = "Average Inequality Index vs. Average Happiness Score",
       subtitle = "For country, over all years (2005 - 2023)")
```
The animated plot shows how the relationship between inequality and happiness changes over time from 2005 to 2023. While variability exists year-to-year, the overall negative trend persists throughout the time period.

```{r}
library(gganimate)
library(gifski)

gapminder_anim <- gapminder_clean |> 
  ggplot(aes(x = inequality_score, y = happ_score)) +
  geom_jitter() +
  labs(x = "Inequality Index",
       y = "Happiness Score",
       subtitle = "{frame_time}",
       title = "Inequality Index vs. Happiness Score") +
  theme(plot.subtitle = element_text(color = "steelblue", size = 14),
        plot.title = element_text(hjust = 0.5)) +
  transition_time(year) +
  ease_aes("linear")

animate(gapminder_anim, nframes = 19, fps = 1)
```

## Linear Regression

To investigate the relationship between inequality and happiness, we computed the average inequality index and average happiness score for each country over the period 2005 to 2023. These average values were used to build a simple linear regression model, with happiness as the response variable and inequality as the explanatory variable.

```{r}
gapminder_average_lm <- lm(avg_happ ~ avg_ineq,
                           data = gapminder_average)

gapminder_average_lm |> 
  tidy()

glance(gapminder_average_lm)
```

The model is
\begin{align}
\widehat{happiness} & = 65.653-0.188\times inequality.
\end{align}

This equation suggests that for every one-point increase in the inequality index, a country’s average happiness score decreases by approximately 0.188 points. This negative association supports our hypothesis that countries with higher income inequality tend to report lower levels of happiness.

## Model Fit

The table below summarizes the variance in the observed happiness scores, the fitted values from the regression model, and the model residuals. The R-squared value indicates that only a small proportion of the total variance is explained by inequality.

```{r}
augment(gapminder_average_lm) |> 
  mutate(var_fitted = var(.fitted),
         var_resp = var(avg_happ),
         var_resid = var(.resid),
         r_square = var_fitted / var_resp) |> 
  select(var_resp, var_fitted, var_resid, r_square) |> 
  distinct() |> 
  kable(digits = c(2, 2, 2, 4),
        col.names = c("Response Values", "Fitted Values", "Residuals", "R-squared"),
        caption = "Model Fit") |> 
  kable_styling(full_width = FALSE, bootstrap_options = "striped") |> 
  add_header_above(c("Variance in" = 3, " " =  1),
                   bold = TRUE) |> 
  row_spec(row = 0, bold = T, align = "c")
```


We evaluated the model's performance by examining how much of the variation in happiness scores it was able to explain. The total variance in happiness scores across countries was approximately 93, while the variance explained by the regression model was about 1.9. This leaves roughly 90.7 units of unexplained variance, resulting in an R-squared value of 0.021.

This means that only 2.1% of the variation in average happiness scores can be explained by differences in income inequality. While the relationship is negative, as expected, the small R-squared value suggests that inequality alone is not a strong predictor of happiness. Other factors; such as health, education, political stability, and social support, are likely more influential and should be considered in future models.


## Citations

- Gapminder: https://www.gapminder.org/data/
- WHO report on social determinants of health: https://www.who.int/publications/i/item/9789241563970
- Add any other articles or sources used to support your hypothesis.
